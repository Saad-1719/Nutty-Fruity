<%- include('../partials/head', {title: 'Page Title' }) %> <%-
include('../partials/headerSub') %>
<style>
	body {
		font-family: Arial, sans-serif;
		background-color: #f8f9fa;
	}
	.heading-container {
		display: flex;
		justify-content: center;
		margin-top: 30px;
	}

    .filter-btn {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
    }
    .filter-btn button{
        margin: 0 10px;
        padding: 12px 32px;
    }
	.product-container {
		display: flex;
		/* max-width: 800px; */
		margin: 50px;
		flex-direction: row-reverse;
	}

	.product-list {
		flex: 1;
	}

	#count {
		height: 22px;
		width: 22px;
		display: flex;
		align-items: left;
		justify-content: center;
		border-radius: 22px;
		background-color: goldenrod;
		color: white;
	}
	.cart-container {
		/* margin-top: 90px; */
		display: flex;
		width: 30%;
		margin-bottom: 30px;
		flex-direction: row-reverse;
		justify-content: center;
	}
	.sidebar {
		width: 100%;
		border-radius: 5px;
		background-color: #eee;
		margin-left: 20px;
		padding: 20px;
		text-align: center;
	}
	.head {
		background-color: goldenrod;
		border-radius: 3px;
		height: 40px;
		padding: 10px;
		margin-bottom: 20px;
		color: white;
		display: flex;
		align-items: center;
	}
	.foot {
		display: flex;
		justify-content: space-between;
		margin: 20px 0px;
		padding: 10px 0px;
		border-top: 1px solid #333;
	}

	.foot h2 {
		font-size: 20px;
		color: red;
	}
	.cart-item {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: 10px;
		background-color: white;
		border-bottom: 1px solid #aaa;
		border-radius: 3px;
		margin: 10px 10px;
	}
	.row-img {
		width: 50px;
		height: 50px;
		border-radius: 50px;
		border: 1px solid goldenrod;
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.rowimg {
		max-width: 43px;
		max-height: 43px;
		border-radius: 50%;
	}
	.fa-trash:hover {
		cursor: pointer;
		color: #333;
	}
</style>
<div class="heading-container">
	<h2 class="text-center mb-4">Products</h2>
</div>
<div class="filter-btn">
    <button
        class="btn btn-primary filter-button show-button"
        product-category="all"
    >
        All
    </button>
    <button
        class="btn btn-primary filter-button show-button"
        product-category="Fruits"
    >
        Fruits
    </button>
    <button
        class="btn btn-primary filter-button show-button"
        product-category="Vegetables"
    >
        Vegetables
    </button>
</div>
<div class="product-container">
	<div class="cart-container">
		<div id="root"></div>
		<div class="sidebar">
			<div class="head">
				<p>My Cart</p>
				<p id="count">0</p>
			</div>
			<div id="cartItem">Your cart is empty</div>
			<div class="foot">
				<h3>Total</h3>
				<h2 id="total">$ 0.00</h2>
			</div>
		</div>
	</div>
	<div class="product-list">
		<!-- Filter Menu -->

		<div class="row" id="product-list">
			<% products.forEach((product)=> { %>
			<div class="col-md-4" data-category="<%= product.category %>">
				<div class="card">
					<img
						src="<%= product.image %>"
						class="card-img-top"
						alt="<%= product.name %>"
					/>
					<div class="card-body">
						<h5 class="card-title"><%= product.name %></h5>
						<p class="card-text">Weight: <%= product.weight %> g</p>
						<p class="card-text">Price: <%= product.price %></p>
						<button
							class="btn btn-primary add-to-cart-btn"
							data-id="<%= product.id %>"
							data-name="<%= product.name %>"
							data-price="<%= product.price %>"
							data-image="<%= product.image %>"
						>
							Add to Cart
						</button>
					</div>
				</div>
			</div>
			<% }) %>
		</div>
	</div>
</div>

<script
	src="https://kit.fontawesome.com/92d70a2fd8.js"
	crossorigin="anonymous"
></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

<script>
	let cart = [];

	function addtocart(id, image, name, price) {
		const productToAdd = { id, image, name, price };
		cart.push(productToAdd);
		displaycart();
	}

	function delElement(index) {
		cart.splice(index, 1);
		displaycart();
	}

	function displaycart() {
		let total = 0;
		const cartElement = document.getElementById("cartItem");
		cartElement.innerHTML = "";
		cart.forEach((item, index) => {
			const { image, name, price } = item;
			total += price;
			cartElement.innerHTML += `
				<div class='cart-item'>
					<div class='row-img'>
						<img class='rowimg' src='${image}'>
					</div>
					<p style='font-size:12px;'>${name}</p>
					<h2 style='font-size: 15px;'>$ ${price}.00</h2>
					<i class='fa-solid fa-trash' onclick='delElement(${index})'></i>
				</div>`;
		});
		document.getElementById("count").textContent = cart.length;
		document.getElementById("total").textContent = `$ ${total}.00`;
	}

	document.addEventListener("DOMContentLoaded", function () {
		const productList = document.getElementById("product-list");
		productList.addEventListener("click", function (event) {
			if (event.target.classList.contains("add-to-cart-btn")) {
				const id = parseInt(event.target.dataset.id);
				const image = event.target.dataset.image;
				const name = event.target.dataset.name;
				const price = parseFloat(event.target.dataset.price);
				addtocart(id, image, name, price);
			}
		});
	});
	$(document).ready(function () {
		$(".filter-button").click(function () {
			var category = $(this).attr("product-category");
			if (category === "all") {
				$("[data-category]").show();
			} else {
				$("[data-category]").hide();
				$('[data-category="' + category + '"]').show();
			}
		});
	});
</script>
